pragma solidity 0.8.17;

import "forge-std/test.sol";
import "@dex/DexRouter.sol";

import "@dex/adapter/NativePmmAdapterV2.sol";

contract NativePmmAdapterV2Test is Test {
    address constant ETH = address(0);
    address constant WETH = 0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2;
    address constant USDT = 0xdAC17F958D2ee523a2206206994597C13D831ec7;

    function test_tradeNativePmmV2() public {
        vm.createSelectFork("https://eth.llamarpc.com");
        vm.warp(1732269052);

        vm.etch(
            0xbf381E1cBfdb0D02F3800010e490130D3dC73118,
            address(new NativePmmAdapterV2(WETH)).code
        );

        NativePmmAdapterV2 adapter = NativePmmAdapterV2(
            payable(address(0xbf381E1cBfdb0D02F3800010e490130D3dC73118))
        );

        // {
        //     "router_version": "1",
        //     "success": true,
        //     "source": "p1.4",
        //     "functionCall": "tradeRFQT",
        //     "orders": [
        //         {
        //             "pool": "0x1E4B383C14D9001460C810565e770950629615ab",
        //             "signer": "0xb49e1e44010f9d3a840abd20cbd8b2ff07448f32",
        //             "recipient": "0xbf381E1cBfdb0D02F3800010e490130D3dC73118",
        //             "sellerToken": "0x97ad75064b20fb2b2447fed4fa953bf7f007a706",
        //             "buyerToken": "0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2",
        //             "sellerTokenAmount": "100000000000000",
        //             "buyerTokenAmount": "100061478544003",
        //             "deadlineTimestamp": 1739264477,
        //             "nonce": 7747937531547081,
        //             "quoteId": "0xf032dc0960ff4f6dac83cbb8fcae5769",
        //             "multiHop": false,
        //             "signature": "0x080ac6093b527c9c950e8943635b511e50c4d7321dededc296d92d972d98b7e10c94319dbe4b897cc8c8225bbdad23768bff3802526664274dcf6b28b8af8abb1c",
        //             "externalSwapCalldata": "0x",
        //             "amountOutMinimum": "99060863758562",
        //             "widgetFee": {
        //                 "feeRate": "1",
        //                 "feeRecipient": "0xfA7f2F2ce037fC87846fD118E944Db50C31875eb"
        //             },
        //             "widgetFeeSignature": "0xeb658570d675748656a30168bc51a9be6af3da5431b1d613a82153e953548d393d200cfb94c67e8509501a8f99ab1b1fe64ace74b9346a4ae22fd400895029831b"
        //         }
        //     ],
        //     "calldata": "0x000000000000000000000000000000000000000000000000001b86b5484f4dc9b49e1e44010f9d3a840abd20cbd8b2ff07448f321e4b383c14d9001460c810565e770950629615abbf381e1cbfdb0d02f3800010e490130d3dc73118c02aaa39b223fe8d0a0e5c4f27ead9083c756cc297ad75064b20fb2b2447fed4fa953bf7f007a70600000000000000000000000000000000000000000000000000005b0160e2628300000000000000000000000000000000000000000000000000005af3107a40000000000000000000000000000000000000000000000000000000000067ab11ddbf381e1cbfdb0d02f3800010e490130d3dc73118f032dc0960ff4f6dac83cbb8fcae5769080ac6093b527c9c950e8943635b511e50c4d7321dededc296d92d972d98b7e10c94319dbe4b897cc8c8225bbdad23768bff3802526664274dcf6b28b8af8abb1c",
        //     "amountIn": "100000000000000",
        //     "amountOut": "100051472396148",
        //     "toWrap": false,
        //     "toUnwrap": false,
        //     "fallbackSwapDataArray": [],
        //     "txRequest": {
        //         "target": "0x5C0aBf0F651613696A5c57efafC6ab59A460B32d",
        //         "calldata": "0x93eb86e400000000000000000000000000000000000000000000000000000000000000200000000000000000000000001e4b383c14d9001460c810565e770950629615ab000000000000000000000000b49e1e44010f9d3a840abd20cbd8b2ff07448f32000000000000000000000000bf381e1cbfdb0d02f3800010e490130d3dc7311800000000000000000000000097ad75064b20fb2b2447fed4fa953bf7f007a706000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc200000000000000000000000000000000000000000000000000005af3107a400000000000000000000000000000000000000000000000000000005b0160e262830000000000000000000000000000000000000000000000000000000067ab11dd000000000000000000000000000000000000000000000000001b86b5484f4dc9f032dc0960ff4f6dac83cbb8fcae57690000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000220000000000000000000000000fa7f2f2ce037fc87846fd118e944db50c31875eb000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000002a0000000000000000000000000000000000000000000000000000000000000032000000000000000000000000000000000000000000000000000005a18679870e20000000000000000000000000000000000000000000000000000000000000041080ac6093b527c9c950e8943635b511e50c4d7321dededc296d92d972d98b7e10c94319dbe4b897cc8c8225bbdad23768bff3802526664274dcf6b28b8af8abb1c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000041eb658570d675748656a30168bc51a9be6af3da5431b1d613a82153e953548d393d200cfb94c67e8509501a8f99ab1b1fe64ace74b9346a4ae22fd400895029831b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
        //         "value": "0"
        //     },
        //     "amountInOffset": 196,
        //     "amountOutMinimumOffset": 0
        // }

        deal(
            0x97Ad75064b20fb2B2447feD4fa953bF7F007a706,
            address(adapter),
            100000000000000
        );
        adapter.sellBase(
            address(this),
            0x5C0aBf0F651613696A5c57efafC6ab59A460B32d,
            // abi.encode(quote)
            hex"00000000000000000000000000000000000000000000000000000000000000200000000000000000000000001e4b383c14d9001460c810565e770950629615ab000000000000000000000000b49e1e44010f9d3a840abd20cbd8b2ff07448f32000000000000000000000000bf381e1cbfdb0d02f3800010e490130d3dc7311800000000000000000000000097ad75064b20fb2b2447fed4fa953bf7f007a706000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc200000000000000000000000000000000000000000000000000005af3107a400000000000000000000000000000000000000000000000000000005b0160e262830000000000000000000000000000000000000000000000000000000067ab11dd000000000000000000000000000000000000000000000000001b86b5484f4dc9f032dc0960ff4f6dac83cbb8fcae57690000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000220000000000000000000000000fa7f2f2ce037fc87846fd118e944db50c31875eb000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000002a0000000000000000000000000000000000000000000000000000000000000032000000000000000000000000000000000000000000000000000005a18679870e20000000000000000000000000000000000000000000000000000000000000041080ac6093b527c9c950e8943635b511e50c4d7321dededc296d92d972d98b7e10c94319dbe4b897cc8c8225bbdad23768bff3802526664274dcf6b28b8af8abb1c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000041eb658570d675748656a30168bc51a9be6af3da5431b1d613a82153e953548d393d200cfb94c67e8509501a8f99ab1b1fe64ace74b9346a4ae22fd400895029831b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
        );
    }
}
